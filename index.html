<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Vehicle Bounce v–t Graphs</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2 style="text-align:center;">Velocity–Time Graph: Vehicle Released from Ramp (Initial v = 0)</h2>
  <div id="plot" style="width:95%;max-width:1200px;margin:auto;"></div>

<script>
// Parameters
const firstPeakVelocity = 2; // m/s after ramp acceleration
const bounceCount = 6;       // total bounces
const timePerLeg = 1;        // seconds between events
const damping = 0.6;         // velocity reduction per bounce

function generateVT(firstPeakV, bounceCount, timePerLeg, damping, direction = 1) {
    let t = [0];
    let v = [0]; // starts at rest
    let labels = {};
    let time = 0;
    let currentV = firstPeakV * direction;

    let eventNames = [
        "Initial release",
        "First impact",
        "First separation",
        "Second impact",
        "Second separation"
    ];
    let labelIndex = 0;
    labels[time] = eventNames[labelIndex++]; // label at t=0

    // Accelerate to first impact
    time += timePerLeg;
    t.push(time);
    v.push(currentV);
    if (labelIndex < eventNames.length) labels[time] = eventNames[labelIndex++];

    for (let i = 0; i < bounceCount; i++) {
        // Impact reversal
        time += timePerLeg;
        currentV = -currentV; // reverse direction instantly
        t.push(time);
        v.push(currentV);
        if (labelIndex < eventNames.length) labels[time] = eventNames[labelIndex++];

        // Separation with damping
        time += timePerLeg;
        currentV *= damping;
        t.push(time);
        v.push(currentV);
        if (labelIndex < eventNames.length) labels[time] = eventNames[labelIndex++];
    }
    return {t, v, labels};
}

let posData = generateVT(firstPeakVelocity, bounceCount, timePerLeg, damping, 1);
let negData = generateVT(firstPeakVelocity, bounceCount, timePerLeg, damping, -1);

function createTrace(data, name, color) {
    return {
        x: data.t,
        y: data.v,
        mode: 'lines+markers',
        name: name,
        line: {color: color},
        marker: {size: 6}
    };
}

function createAnnotations(data, subplot) {
    let annots = [];
    for (let tVal in data.labels) {
        annots.push({
            x: parseFloat(tVal),
            y: data.v[data.t.indexOf(parseFloat(tVal))],
            xref: subplot === 1 ? 'x1' : 'x2',
            yref: subplot === 1 ? 'y1' : 'y2',
            text: data.labels[tVal],
            showarrow: true,
            arrowhead: 2,
            ax: 0,
            ay: -30
        });
    }
    return annots;
}

let tracePos = createTrace(posData, "Ramp release → Positive direction", "blue");
let traceNeg = createTrace(negData, "Ramp release → Negative direction", "red");

let layout = {
    grid: {rows: 1, columns: 2, pattern: 'independent'},
    height: 500,
    width: 1200,
    title: "Vehicle Released from Ramp, Bouncing until Stop",
    xaxis: {title: "Time (s)", range: [0, (bounceCount+2)*timePerLeg]},
    yaxis: {title: "Velocity (m/s)", zeroline: true},
    xaxis2: {title: "Time (s)", range: [0, (bounceCount+2)*timePerLeg]},
    yaxis2: {title: "Velocity (m/s)", zeroline: true},
    annotations: [
        ...createAnnotations(posData, 1),
        ...createAnnotations(negData, 2)
    ]
};

let figData = [
    {...tracePos, xaxis: 'x1', yaxis: 'y1'},
    {...traceNeg, xaxis: 'x2', yaxis: 'y2'}
];

Plotly.newPlot('plot', figData, layout);
</script>
</body>
</html>
