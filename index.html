<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Vehicle Bounce v–t Graphs</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2 style="text-align:center;">Velocity–Time Graph: Vehicle Bouncing off Styrofoam Bumper</h2>
  <div id="plot" style="width:95%;max-width:1200px;margin:auto;"></div>

<script>
// Parameters
const initialVelocity = 2; // m/s
const bounceCount = 6;     // total bounces
const timePerLeg = 1;      // seconds between events
const damping = 0.6;       // velocity reduction per bounce

// Function to generate v–t data
function generateVT(initialV, bounceCount, timePerLeg, damping) {
    let t = [0];
    let v = [initialV];
    let labels = {};
    let currentV = initialV;
    let time = 0;
    let eventNames = ["Initial release", "First impact", "First separation", "Second impact", "Second separation"];
    let labelIndex = 0;

    // Initial release label
    labels[time] = eventNames[labelIndex++];

    for (let i = 0; i < bounceCount; i++) {
        // Impact
        time += timePerLeg;
        currentV = -currentV; // instant reversal
        t.push(time);
        v.push(currentV);
        if (labelIndex < eventNames.length) labels[time] = eventNames[labelIndex++];

        // Separation
        time += timePerLeg;
        currentV = currentV * damping; // reduce amplitude
        t.push(time);
        v.push(currentV);
        if (labelIndex < eventNames.length) labels[time] = eventNames[labelIndex++];
    }
    return {t, v, labels};
}

let posData = generateVT(initialVelocity, bounceCount, timePerLeg, damping);
let negData = generateVT(-initialVelocity, bounceCount, timePerLeg, damping);

// Function to create trace for main curve
function createTrace(data, name, color) {
    return {
        x: data.t,
        y: data.v,
        mode: 'lines+markers',
        name: name,
        line: {color: color},
        marker: {size: 6}
    };
}

// Function to create annotation points
function createAnnotations(data) {
    let annots = [];
    for (let tVal in data.labels) {
        annots.push({
            x: parseFloat(tVal),
            y: data.v[data.t.indexOf(parseFloat(tVal))],
            xref: 'x',
            yref: 'y',
            text: data.labels[tVal],
            showarrow: true,
            arrowhead: 2,
            ax: 0,
            ay: -30
        });
    }
    return annots;
}

let tracePos = createTrace(posData, "Initial velocity positive", "blue");
let traceNeg = createTrace(negData, "Initial velocity negative", "red");

let layout = {
    grid: {rows: 1, columns: 2, pattern: 'independent'},
    annotations: [],
    height: 500,
    width: 1200,
    title: "Vehicle Released from Ramp, Bouncing until Stop",
};

let figData = [
    {...tracePos, xaxis: 'x1', yaxis: 'y1'},
    {...traceNeg, xaxis: 'x2', yaxis: 'y2'}
];

// Apply annotations separately for each subplot
let annotsPos = createAnnotations(posData).map(a => ({...a, xref:'x1', yref:'y1'}));
let annotsNeg = createAnnotations(negData).map(a => ({...a, xref:'x2', yref:'y2'}));
layout.annotations = annotsPos.concat(annotsNeg);

// Axis settings
layout.xaxis = {title: "Time (s)", range: [0, (bounceCount+1)*timePerLeg*2]};
layout.yaxis = {title: "Velocity (m/s)", zeroline: true};
layout.xaxis2 = {title: "Time (s)", range: [0, (bounceCount+1)*timePerLeg*2]};
layout.yaxis2 = {title: "Velocity (m/s)", zeroline: true};

Plotly.newPlot('plot', figData, layout);
</script>
</body>
</html>
